'use client';

import { createContext, useCallback, useContext, useEffect, useMemo, useState } from 'react';

export type Locale = 'zh' | 'en';

const STORAGE_KEY = 'cgm_locale';

const MESSAGES: Record<Locale, Record<string, string>> = {
  zh: {
    'nav.dashboard': '仪表盘',
    'nav.logs': '日志',
    'nav.incidents': '事故',
    'nav.settings': '设置',
    'nav.logout': '退出',

    'common.loading': '加载中…',
    'common.refresh': '刷新',
    'common.back': '返回',
    'common.create': '创建',
    'common.search': '搜索',
    'common.upload': '上传',
    'common.loadMore': '加载更多',
    'common.prevPage': '上一页',
    'common.nextPage': '下一页',
    'common.close': '关闭',
    'common.copy': '复制',
    'common.copied': '已复制',
    'common.copyFailed': '复制失败',
    'common.items': '共 {count} 条',
    'common.none': '无',
    'common.yes': '是',
    'common.no': '否',

    'table.time': '时间',
    'table.event': '事件',
    'table.level': '级别',
    'table.sdk': 'SDK',
    'table.app': '应用',
    'table.id': 'ID',
    'table.title': '标题',
    'table.status': '状态',
    'table.updated': '更新时间',
    'table.logEvents': '日志事件数',
    'table.actions': '操作',

    'project.label': '项目',
    'project.current': '当前项目',
    'project.selectPlaceholder': '请选择项目…',

    'dashboard.title': '仪表盘',
    'dashboard.needProjectHint': '需要先登录并在数据库中有可访问的项目。',
    'dashboard.corePages': '核心页面',
    'dashboard.settings': '设置',
    'dashboard.adminHint': '默认管理员账号：{email} / {password}（seed 可改）',

    'login.title': '登录',
    'login.desc': '使用 API 的 JWT 登录，token 会保存在浏览器 localStorage。',
    'login.email': '邮箱',
    'login.password': '密码',
    'login.submit': '登录',
    'login.submitting': '登录中…',

    'logs.title': '日志',
    'logs.uploadTitle': '上传日志文件（JSONL/Logan）',
    'logs.uploadHint':
      '支持上传“解码后的 JSONL”（每行是一个 outer JSON，含字段 c/f/l/...）或 Logan 加密二进制文件（平台将自动解密）。',
    'logs.files.browse': '文件列表',
    'logs.files.title': '日志文件',
    'logs.files.backToLogs': '返回日志',
    'logs.files.viewContent': '查看文件内容',
    'logs.files.uploadedAt': '上传时间',
    'logs.files.fileName': '文件名',
    'logs.files.status': '状态',
    'logs.files.events': '事件数',
    'logs.files.errors': '错误数',
    'logs.files.empty': '暂无日志文件',
    'logs.files.detail.title': '文件详情',
    'logs.files.viewerTitle': '文件内容',
    'logs.files.viewerLegend': '事件颜色图例',
    'logs.files.viewerStream': '日志流',
    'logs.files.viewerExpand': '展开详情',
    'logs.files.viewerCollapse': '收起详情',
    'logs.files.viewerPage': '第 {page} / {totalPages} 页',
    'logs.files.viewerLoaded': '已加载 {loaded} / {total} 条',
    'logs.files.openInLogs': '在日志中查看事件',
    'logs.files.delete': '删除文件',
    'logs.files.deleteConfirm':
      '确认删除日志文件“{fileName}”？这将删除相关事件数据与关联关系，且不可恢复。',
    'logs.files.timeRange': '时间范围',
    'logs.files.timeRangeUnknown': '未知',
    'logs.files.tracking.title': '追踪字段概览',
    'logs.files.tracking.deviceSn': 'SN',
    'logs.files.tracking.deviceMac': 'MAC',
    'logs.files.tracking.linkCode': 'linkCode',
    'logs.files.tracking.stats': '命中 {events} 条，唯一 {distinct} 个',
    'logs.files.tracking.coverage': '覆盖 {percent}%',
    'logs.files.backendQuality.title': '后台接口诊断（HTTP/MQTT）',
    'logs.files.backendQuality.hint':
      '用于定位“服务器上传/接口调用”问题：统计 HTTP 请求成功率与耗时分布，并汇总 MQTT 批次发送/发布/ACK 结果与超时情况。',
    'logs.files.backendQuality.viewHttpFailed': '查看 HTTP 失败',
    'logs.files.backendQuality.viewAckTimeouts': '查看 ACK 超时',
    'logs.files.backendQuality.viewMqttPublishFailed': '查看 MQTT 发布失败',
    'logs.files.backendQuality.httpOpen': '未结束',
    'logs.files.backendQuality.httpAvg': '平均',
    'logs.files.backendQuality.httpP95': 'P95',
    'logs.files.backendQuality.uploadBatchSent': '批次',
    'logs.files.backendQuality.publishOk': '发布成功',
    'logs.files.backendQuality.ackOk': 'ACK 成功',
    'logs.files.backendQuality.subscribeFail': '订阅失败',
    'logs.files.backendQuality.snMissing': 'SN 缺失',
    'logs.files.backendQuality.snMissingHint':
      '这些 MQTT 问题事件里没有解析到设备 SN，无法按设备聚合。',
    'logs.files.backendQuality.showDetails': '显示详情',
    'logs.files.backendQuality.hideDetails': '隐藏详情',
    'logs.files.backendQuality.httpTop': 'HTTP 失败 Top（按路径聚合）',
    'logs.files.backendQuality.httpPath': '路径',
    'logs.files.backendQuality.httpOk': '成功',
    'logs.files.backendQuality.httpFail': '失败',
    'logs.files.backendQuality.httpTotal': '总数',
    'logs.files.backendQuality.mqttDeviceTop': 'MQTT 设备问题 Top',
    'logs.files.backendQuality.deviceSn': '设备 SN',
    'logs.files.backendQuality.ackTimeout': 'ACK 超时',
    'logs.files.backendQuality.ackFail': 'ACK 失败',
    'logs.files.backendQuality.publishFail': '发布失败',
    'logs.files.backendQuality.notConnected': '未连接跳过',
    'logs.files.backendQuality.traceSn': '追踪 SN',
    'logs.files.dataContinuity.title': '数据连续性诊断（raw index）',
    'logs.files.dataContinuity.hint':
      '用于定位“数据缺口/乱序/入库阻塞”问题：汇总 raw index 连续性异常（乱序/丢包、入库超时、实时缓存丢弃），并支持按 SN / linkCode 快速跳转定位。',
    'logs.files.dataContinuity.viewOrderBroken': '查看乱序/丢包',
    'logs.files.dataContinuity.viewOutOfOrderBuffered': '查看乱序缓存',
    'logs.files.dataContinuity.viewDuplicateDropped': '查看重复丢弃',
    'logs.files.dataContinuity.viewPersistTimeout': '查看入库超时',
    'logs.files.dataContinuity.viewRtBufferDrop': '查看实时缓存丢弃',
    'logs.files.dataContinuity.showDetails': '显示详情',
    'logs.files.dataContinuity.hideDetails': '隐藏详情',
    'logs.files.dataContinuity.total': '总数',
    'logs.files.dataContinuity.orderBroken': '乱序/丢包',
    'logs.files.dataContinuity.outOfOrderBuffered': '乱序缓存',
    'logs.files.dataContinuity.duplicateDropped': '重复丢弃',
    'logs.files.dataContinuity.persistTimeout': '入库超时',
    'logs.files.dataContinuity.rtBufferDrop': '缓存丢弃',
    'logs.files.dataContinuity.snMissing': 'SN 缺失',
    'logs.files.dataContinuity.snMissingHint':
      '这些连续性问题事件里没有解析到设备 SN，无法按设备聚合。',
    'logs.files.dataContinuity.linkCodeMissing': 'linkCode 缺失',
    'logs.files.dataContinuity.linkCodeMissingHint':
      '这些连续性问题事件里没有解析到 linkCode，无法按连接会话聚合。',
    'logs.files.dataContinuity.requestIdMissing': 'requestId 缺失',
    'logs.files.dataContinuity.requestIdMissingHint':
      '这些连续性问题事件里没有解析到 requestId，无法按请求维度追踪到 Trace。',
    'logs.files.dataContinuity.deviceTop': '设备问题 Top',
    'logs.files.dataContinuity.linkCodeTop': '会话问题 Top（按 linkCode 聚合）',
    'logs.files.dataContinuity.requestIdTop': '请求问题 Top（按 requestId 聚合）',
    'logs.files.dataContinuity.deviceSn': '设备 SN',
    'logs.files.dataContinuity.linkCode': 'linkCode',
    'logs.files.dataContinuity.requestId': 'requestId',
    'logs.files.dataContinuity.traceSn': '追踪 SN',
    'logs.files.dataContinuity.traceLinkCode': '追踪 linkCode',
    'logs.files.dataContinuity.traceRequestId': '追踪 requestId',
    'logs.files.streamSessionQuality.title': '数据流会话质量（会话总结）',
    'logs.files.streamSessionQuality.hint':
      '用于定位“流式会话质量”问题：汇总 DATA_STREAM_SESSION_SUMMARY 的会话结束快照，给出启发式评分与阈值告警，并支持按 SN / linkCode / requestId 快速追踪。',
    'logs.files.streamSessionQuality.viewSessions': '查看会话总结',
    'logs.files.streamSessionQuality.showDetails': '显示详情',
    'logs.files.streamSessionQuality.hideDetails': '隐藏详情',
    'logs.files.streamSessionQuality.total': '会话数',
    'logs.files.streamSessionQuality.score': '评分',
    'logs.files.streamSessionQuality.scoreAvg': '平均分',
    'logs.files.streamSessionQuality.scoreHint':
      '评分为启发式计算（基于会话总结字段与缺失情况），用于快速定位可能的异常会话。',
    'logs.files.streamSessionQuality.thresholdHint': '阈值：警告 <{warnBelow}，异常 <{badBelow}',
    'logs.files.streamSessionQuality.qualityGood': 'OK',
    'logs.files.streamSessionQuality.qualityWarn': '警告',
    'logs.files.streamSessionQuality.qualityBad': '异常',
    'logs.files.streamSessionQuality.deviceSn': '设备 SN',
    'logs.files.streamSessionQuality.linkCode': 'linkCode',
    'logs.files.streamSessionQuality.requestId': 'requestId',
    'logs.files.streamSessionQuality.reason': '原因',
    'logs.files.streamSessionQuality.time': '时间',
    'logs.files.streamSessionQuality.rawStartIndex': '起始 raw',
    'logs.files.streamSessionQuality.nextExpectedRaw': '期望 raw',
    'logs.files.streamSessionQuality.lastRaw': '最新 raw',
    'logs.files.streamSessionQuality.bufferedOutOfOrderCount': '乱序缓存',
    'logs.files.streamSessionQuality.persistedMax': '入库推进',
    'logs.files.streamSessionQuality.reasonTop': '原因 Top',
    'logs.files.streamSessionQuality.deviceTop': '设备会话 Top',
    'logs.files.streamSessionQuality.linkCodeTop': '会话 Top（按 linkCode 聚合）',
    'logs.files.streamSessionQuality.requestIdTop': '请求 Top（按 requestId 聚合）',
    'logs.files.streamSessionQuality.sessionsRecent': '最近会话（按时间倒序）',
    'logs.files.streamSessionQuality.snMissing': 'SN 缺失',
    'logs.files.streamSessionQuality.snMissingHint':
      '这些会话总结里没有解析到设备 SN，无法按设备聚合。',
    'logs.files.streamSessionQuality.linkCodeMissing': 'linkCode 缺失',
    'logs.files.streamSessionQuality.linkCodeMissingHint':
      '这些会话总结里没有解析到 linkCode，无法按连接会话聚合。',
    'logs.files.streamSessionQuality.requestIdMissing': 'requestId 缺失',
    'logs.files.streamSessionQuality.requestIdMissingHint':
      '这些会话总结里没有解析到 requestId，无法按请求维度追踪到 Trace。',
    'logs.files.streamSessionQuality.reasonMissing': 'reason 缺失',
    'logs.files.streamSessionQuality.reasonMissingHint':
      '这些会话总结里没有解析到 reason，无法按关闭原因聚合。',
    'logs.files.streamSessionQuality.sessionStartIndexMissing': 'sessionStartIndex 缺失',
    'logs.files.streamSessionQuality.sessionStartIndexMissingHint':
      '这些会话总结里没有解析到 sessionStartIndex，无法还原会话起点 raw index。',
    'logs.files.streamSessionQuality.sessionStartAtMsMissing': 'sessionStartAtMs 缺失',
    'logs.files.streamSessionQuality.sessionStartAtMsMissingHint':
      '这些会话总结里没有解析到 sessionStartAtMs，无法还原会话起点时间。',
    'logs.files.streamSessionQuality.traceSn': '追踪 SN',
    'logs.files.streamSessionQuality.traceLinkCode': '追踪 linkCode',
    'logs.files.streamSessionQuality.traceRequestId': '追踪 requestId',
    'logs.files.bleQuality.title': '蓝牙 SDK 必需日志检查',
    'logs.files.bleQuality.hint':
      '用于定位“日志丢失/不一致”问题：检查必需事件是否出现、等级是否匹配、以及关键流程是否存在开始但缺少结束日志的情况。',
    'logs.files.bleQuality.coverage': '覆盖率（OK/总数）',
    'logs.files.bleQuality.missing': '缺失（未出现）',
    'logs.files.bleQuality.levelMismatch': '等级不匹配',
    'logs.files.bleQuality.nameMismatch': '事件名不一致（大小写/空格）',
    'logs.files.bleQuality.parserErrors': '解析错误（PARSER_ERROR）',
    'logs.files.bleQuality.logan': 'Logan 解密失败块',
    'logs.files.bleQuality.loganFailedBlocks': '块失败',
    'logs.files.bleQuality.missingList': '缺失事件',
    'logs.files.bleQuality.levelMismatchList': '等级不匹配事件',
    'logs.files.bleQuality.nameMismatchList': '事件名不一致（可能是埋点字符串变化）',
    'logs.files.bleQuality.pairChecks': '关键流程对照（出现开始但缺少结束）',
    'logs.files.bleQuality.viewParserErrors': '查看解析错误',
    'logs.files.bleQuality.showAdvanced': '显示高级检查',
    'logs.files.bleQuality.hideAdvanced': '隐藏高级检查',
    'logs.files.bleQuality.tab.missing': '缺失',
    'logs.files.bleQuality.tab.levelMismatch': '等级不匹配',
    'logs.files.bleQuality.tab.nameMismatch': '事件名不一致',
    'logs.files.bleQuality.tab.pairChecks': '流程对照',
    'logs.files.bleQuality.openInLogs': '在日志中查看',
    'logs.files.bleQuality.emptySection': '这一项没有发现问题',
    'logs.files.bleQuality.table.eventName': 'eventName',
    'logs.files.bleQuality.table.description': '说明',
    'logs.files.bleQuality.table.expectedLevel': '期望等级',
    'logs.files.bleQuality.table.category': '分类',
    'logs.files.bleQuality.table.counts': '统计',
    'logs.files.bleQuality.table.matchedEventNames': '匹配到的事件名',
    'logs.files.bleQuality.table.flow': '流程',
    'logs.files.bleQuality.table.endEventNames': '结束事件',
    'logs.files.bleQuality.table.pendingCount': '未闭环次数',
    'logs.files.bleQuality.table.actions': '操作',
    'logs.limit': '每页条数',
    'logs.keyword': '关键词（可选）',
    'logs.logFileIdOptional': 'logFileId（可选）',
    'logs.level': '级别',
    'logs.level.all': '全部',
    'logs.levelGte': '最低级别',
    'logs.sdkVersion': 'SDK 版本',
    'logs.appId': '应用 ID',
    'logs.trace': '追踪',
    'logs.stats': '统计',
    'logs.eventNameOptional': 'eventName（可选）',
    'logs.startTime': '开始时间',
    'logs.endTime': '结束时间',
    'logs.preset.1h': '近 1 小时',
    'logs.preset.24h': '近 24 小时',
    'logs.preset.7d': '近 7 天',
    'logs.parserError': '解析错误',
    'logs.onlyParserError': '只看解析错误',
    'logs.detail.title': '事件详情',
    'logs.detail.close': '关闭',
    'logs.detail.copyEventId': '复制事件 ID',
    'logs.detail.copyLogFileId': '复制 logFileId',
    'logs.detail.context': '上下文',
    'logs.detail.current': '当前事件',
    'logs.detail.contextEmpty': '无上下文',
    'logs.detail.msgJson': 'msgJson',
    'logs.detail.rawLine': 'rawLine（仅解析错误）',
    'logs.fileStatus': '解析状态',
    'logs.fileStatus.queued': '队列中',
    'logs.fileStatus.parsed': '已解析',
    'logs.fileStatus.failed': '解析失败',
    'logs.fileStatus.events': '事件数',
    'logs.fileStatus.errors': '错误数',
    'logs.invalidTimeRange': '结束时间需要晚于开始时间',
    'logs.invalidLogFileId': 'logFileId 格式不正确',
    'logs.timeRangeRequired': '请先选择开始时间与结束时间',
    'logs.empty':
      '暂无数据。请先扩大时间范围或稍等解析完成；如怀疑解析失败，可搜索 eventName=PARSER_ERROR。',
    'logs.msgContains': '消息内容包含',
    'logs.msgContainsPlaceholder': '搜索 msgJson 内容',
    'logs.bluetooth': '蓝牙',
    'logs.commands': '命令链路',
    'logs.commands.description': '追踪 BLE 命令发送和响应的完整链路，快速定位蓝牙通信问题。按设备 MAC 和时间范围筛选。',
    'logs.commands.stats': '命令统计',
    'logs.commands.total': '总计',
    'logs.commands.success': '成功',
    'logs.commands.timeout': '超时',
    'logs.commands.error': '错误',
    'logs.commands.pending': '待定',
    'logs.commands.avgDuration': '平均耗时',
    'logs.commands.list': '命令列表',
    'logs.commands.events': '事件数',
    'logs.commands.duration': '耗时',
    'logs.commands.status': '状态',
    'logs.commands.eventChain': '事件链',
    'logs.trace.relatedDevices': '关联设备',
    'logs.trace.relatedSessions': '关联会话',
    'common.optional': '可选',
    'common.events': '事件',
    'common.view': '查看',
    'common.noData': '暂无数据',
    'common.cancel': '取消',
    'common.confirm': '确认',
    'common.delete': '删除',
    'common.save': '保存',
    'common.edit': '编辑',
    'common.add': '添加',
    'common.remove': '移除',
    'common.success': '操作成功',
    'common.error': '操作失败',

    'logs.filters.moreFilters': '更多筛选',
    'logs.filters.hideFilters': '收起筛选',
    'logs.filters.linkCode': '关联码',
    'logs.filters.requestId': '请求ID',
    'logs.filters.deviceMac': '设备MAC',
    'logs.filters.errorCode': '错误码',

    'logs.bluetooth.sessions': '会话列表',
    'logs.bluetooth.commands': '命令列表',
    'logs.bluetooth.anomalies': '异常模式',
    'logs.bluetooth.errors': '错误分布',
    'logs.bluetooth.compare': '日志对比',
    'logs.bluetooth.noSessions': '暂无会话数据',
    'logs.bluetooth.sessionDetail': '会话详情',
    'logs.bluetooth.deviceInfo': '设备信息',
    'logs.bluetooth.timeline': '时间线',

    'dialog.confirm.title': '确认操作',
    'dialog.confirm.delete': '确认删除？',
    'dialog.confirm.cancel': '取消',
    'dialog.confirm.ok': '确定',

    'incidents.title': '事故',
    'incidents.titleLabel': '标题',
    'incidents.severity': '严重级别',
    'incidents.status': '状态',
    'incidents.startTime': '开始时间（ISO8601）',
    'incidents.endTime': '结束时间（可选，ISO8601 或留空）',
    'incidents.logEventIds': 'logEventIds（可选，逗号分隔）',
    'incidents.markResolved': '标记已解决',
    'incidents.empty': '暂无数据（需要 Support/Admin 权限）。',

    'severity.low': '低',
    'severity.medium': '中',
    'severity.high': '高',
    'severity.critical': '致命',

    'incidentStatus.open': '开启',
    'incidentStatus.investigating': '排查中',
    'incidentStatus.resolved': '已解决',
    'incidentStatus.closed': '已关闭',

    'projects.name': '名称',
    'projects.type': '类型',
    'projects.status': '状态',
    'projects.role': '角色',
    'projects.current': '当前',
    'projects.setCurrent': '设为当前',

    'settings.title': '设置',
    'settings.apiBaseUrl': 'API Base URL',
    'settings.token': 'Token',
    'settings.tokenPresent': '已存在（{count} 字符）',
    'settings.tokenMissing': '缺失',
    'settings.selectedProjectId': '已选择的 projectId',
    'settings.clearProjectSelection': '清除项目选择',
    'settings.refreshPage': '刷新页面',
    'settings.projects.title': '项目',
    'settings.projects.desc': '创建多个 App 项目并在各页面选择使用。',
    'settings.projects.empty': '暂无可访问的项目。',
    'settings.projects.noMatch': '未匹配到项目。',
    'settings.projects.filter': '过滤（可选）',
    'settings.projects.filterPlaceholder': '按名称 / ID / 类型过滤…',
    'settings.projects.rename': '重命名',
    'settings.projects.renamePrompt': '请输入新的项目名称',
    'settings.projects.renameEmpty': '项目名称不能为空。',
    'settings.projects.archive': '归档',
    'settings.projects.archiveConfirm': '确认归档项目“{name}”？',
    'settings.projects.restore': '恢复',
    'settings.projects.restoreConfirm': '确认恢复项目“{name}”？',
    'settings.projects.updated': '已更新',
    'settings.projects.createName': '项目名称',
    'settings.projects.setAsCurrent': '创建后设为当前项目',
    'settings.projects.createApp': '创建 App 项目',
    'settings.projects.created': '已创建项目：{name}',
    'settings.projects.adminOnly': '需要 Admin 权限才能创建项目。',

    'settings.members.open': '成员',
    'settings.members.title': '项目成员',
    'settings.members.email': '邮箱',
    'settings.members.name': '名称',
    'settings.members.role': '角色',
    'settings.members.createdAt': '加入时间',
    'settings.members.empty': '暂无成员。',
    'settings.members.addTitle': '添加 / 更新成员',
    'settings.members.addHint': '按邮箱添加成员（该邮箱必须已存在于用户表）。如果已存在成员则会更新其角色。',
    'settings.members.add': '添加',
    'settings.members.remove': '移除',
    'settings.members.removeConfirm': '确认从项目“{project}”移除成员 {email}？',
    'settings.members.updated': '成员已更新',
    'settings.members.removed': '已移除：{email}',

    'nav.knownIssues': '问题库',
    'nav.reports': '报告',

    'knownIssues.title': '常见问题库',
    'knownIssues.desc': '管理常见问题和解决方案，用于快速诊断日志错误。',
    'knownIssues.create': '添加问题',
    'knownIssues.empty': '暂无问题记录。',
    'knownIssues.titleLabel': '标题',
    'knownIssues.description': '描述',
    'knownIssues.solution': '解决方案',
    'knownIssues.category': '分类',
    'knownIssues.severity': '严重级别',
    'knownIssues.errorCode': '错误码',
    'knownIssues.eventPattern': '事件模式（正则）',
    'knownIssues.msgPattern': '消息模式（正则）',
    'knownIssues.hitCount': '命中次数',
    'knownIssues.isActive': '启用',
    'knownIssues.edit': '编辑',
    'knownIssues.delete': '删除',
    'knownIssues.deleteConfirm': '确认删除问题"{title}"？',
    'knownIssues.created': '问题已添加',
    'knownIssues.updated': '问题已更新',
    'knownIssues.deleted': '问题已删除',

    'issueCategory.connection': '连接',
    'issueCategory.data': '数据',
    'issueCategory.device': '设备',
    'issueCategory.app': '应用',
    'issueCategory.permission': '权限',
    'issueCategory.protocol': '协议',
    'issueCategory.other': '其他',

    'reports.title': '分析报告',
    'reports.desc': '一键生成日志分析报告，包括会话分析、错误分布等。',
    'reports.generate': '生成报告',
    'reports.empty': '暂无报告。',
    'reports.type': '报告类型',
    'reports.linkCode': '会话 linkCode',
    'reports.deviceMac': '设备 MAC',
    'reports.startTime': '开始时间',
    'reports.endTime': '结束时间',
    'reports.view': '查看',
    'reports.export': '导出 Markdown',
    'reports.created': '报告已生成',

    'reportType.session_analysis': '会话分析',
    'reportType.device_comparison': '设备对比',
    'reportType.incident_summary': '事故摘要',
    'reportType.error_distribution': '错误分布',
    'reportType.performance_analysis': '性能分析',

    'compare.title': '日志对比',
    'compare.desc': '对比两个会话或设备的日志差异，快速定位问题。',
    'compare.sessionA': '会话 A',
    'compare.sessionB': '会话 B',
    'compare.compare': '对比',
    'compare.summary': '对比摘要',
    'compare.eventTypes': '事件类型',
    'compare.timeline': '时间线',
    'compare.common': '共有',
    'compare.onlyInA': '仅 A',
    'compare.onlyInB': '仅 B',
  },
  en: {
    'nav.dashboard': 'Dashboard',
    'nav.logs': 'Logs',
    'nav.incidents': 'Incidents',
    'nav.settings': 'Settings',
    'nav.logout': 'Logout',

    'common.loading': 'Loading…',
    'common.refresh': 'Refresh',
    'common.back': 'Back',
    'common.create': 'Create',
    'common.search': 'Search',
    'common.upload': 'Upload',
    'common.loadMore': 'Load more',
    'common.prevPage': 'Prev',
    'common.nextPage': 'Next',
    'common.close': 'Close',
    'common.copy': 'Copy',
    'common.copied': 'Copied',
    'common.copyFailed': 'Copy failed',
    'common.items': '{count} items',
    'common.none': 'None',
    'common.yes': 'Yes',
    'common.no': 'No',

    'table.time': 'Time',
    'table.event': 'Event',
    'table.level': 'Level',
    'table.sdk': 'SDK',
    'table.app': 'App',
    'table.id': 'ID',
    'table.title': 'Title',
    'table.status': 'Status',
    'table.updated': 'Updated',
    'table.logEvents': 'Log events',
    'table.actions': 'Actions',

    'project.label': 'Project',
    'project.current': 'Current project',
    'project.selectPlaceholder': 'Select a project…',

    'dashboard.title': 'Dashboard',
    'dashboard.needProjectHint':
      'Please log in and make sure there is at least one accessible project in the database.',
    'dashboard.corePages': 'Core pages',
    'dashboard.settings': 'Settings',
    'dashboard.adminHint': 'Default admin: {email} / {password} (seed can override)',

    'login.title': 'Login',
    'login.desc': 'Sign in with API JWT. The token is stored in browser localStorage.',
    'login.email': 'Email',
    'login.password': 'Password',
    'login.submit': 'Login',
    'login.submitting': 'Logging in…',

    'logs.title': 'Logs',
    'logs.uploadTitle': 'Upload logs (JSONL/Logan)',
    'logs.uploadHint':
      'Upload decoded JSONL (each line is an outer JSON entry with c/f/l/...), or an encrypted Logan binary file (auto-decrypt on server).',
    'logs.files.browse': 'Files',
    'logs.files.title': 'Log files',
    'logs.files.backToLogs': 'Back to Logs',
    'logs.files.viewContent': 'View content',
    'logs.files.uploadedAt': 'Uploaded',
    'logs.files.fileName': 'File',
    'logs.files.status': 'Status',
    'logs.files.events': 'Events',
    'logs.files.errors': 'Errors',
    'logs.files.empty': 'No log files.',
    'logs.files.detail.title': 'File detail',
    'logs.files.viewerTitle': 'File content',
    'logs.files.viewerLegend': 'Event palette',
    'logs.files.viewerStream': 'Log stream',
    'logs.files.viewerExpand': 'Expand',
    'logs.files.viewerCollapse': 'Collapse',
    'logs.files.viewerPage': 'Page {page} / {totalPages}',
    'logs.files.viewerLoaded': 'Loaded {loaded} / {total}',
    'logs.files.openInLogs': 'Open events in Logs',
    'logs.files.delete': 'Delete',
    'logs.files.deleteConfirm':
      'Delete log file \"{fileName}\"? This will remove related events and links and cannot be undone.',
    'logs.files.timeRange': 'Time range',
    'logs.files.timeRangeUnknown': 'Unknown',
    'logs.files.tracking.title': 'Tracking fields overview',
    'logs.files.tracking.deviceSn': 'SN',
    'logs.files.tracking.deviceMac': 'MAC',
    'logs.files.tracking.linkCode': 'linkCode',
    'logs.files.tracking.stats': 'Matched {events}, unique {distinct}',
    'logs.files.tracking.coverage': 'Coverage {percent}%',
    'logs.files.backendQuality.title': 'Backend calls check (HTTP/MQTT)',
    'logs.files.backendQuality.hint':
      'Helps diagnose “server upload / API calls” issues: aggregates HTTP success rate & latency, and summarizes MQTT batch/publish/ACK outcomes and timeouts.',
    'logs.files.backendQuality.viewHttpFailed': 'View HTTP failures',
    'logs.files.backendQuality.viewAckTimeouts': 'View ACK timeouts',
    'logs.files.backendQuality.viewMqttPublishFailed': 'View MQTT publish failures',
    'logs.files.backendQuality.httpOpen': 'Open',
    'logs.files.backendQuality.httpAvg': 'Avg',
    'logs.files.backendQuality.httpP95': 'P95',
    'logs.files.backendQuality.uploadBatchSent': 'Batch',
    'logs.files.backendQuality.publishOk': 'Publish OK',
    'logs.files.backendQuality.ackOk': 'ACK OK',
    'logs.files.backendQuality.subscribeFail': 'Subscribe fail',
    'logs.files.backendQuality.snMissing': 'SN missing',
    'logs.files.backendQuality.snMissingHint':
      'No device SN extracted for these MQTT issue events, so they cannot be grouped by device.',
    'logs.files.backendQuality.showDetails': 'Show details',
    'logs.files.backendQuality.hideDetails': 'Hide details',
    'logs.files.backendQuality.httpTop': 'HTTP failure top (by path)',
    'logs.files.backendQuality.httpPath': 'Path',
    'logs.files.backendQuality.httpOk': 'OK',
    'logs.files.backendQuality.httpFail': 'Fail',
    'logs.files.backendQuality.httpTotal': 'Total',
    'logs.files.backendQuality.mqttDeviceTop': 'MQTT device issues top',
    'logs.files.backendQuality.deviceSn': 'Device SN',
    'logs.files.backendQuality.ackTimeout': 'ACK timeout',
    'logs.files.backendQuality.ackFail': 'ACK fail',
    'logs.files.backendQuality.publishFail': 'Publish fail',
    'logs.files.backendQuality.notConnected': 'Skipped (offline)',
    'logs.files.backendQuality.traceSn': 'Trace SN',
    'logs.files.dataContinuity.title': 'Data continuity check (raw index)',
    'logs.files.dataContinuity.hint':
      'Helps diagnose “data gaps / out-of-order / persist stalls”: aggregates raw index continuity issues (order broken, persist timeouts, realtime buffer drops) and enables quick trace by SN/linkCode.',
    'logs.files.dataContinuity.viewOrderBroken': 'View order broken',
    'logs.files.dataContinuity.viewOutOfOrderBuffered': 'View out-of-order buffered',
    'logs.files.dataContinuity.viewDuplicateDropped': 'View duplicate dropped',
    'logs.files.dataContinuity.viewPersistTimeout': 'View persist timeouts',
    'logs.files.dataContinuity.viewRtBufferDrop': 'View realtime buffer drops',
    'logs.files.dataContinuity.showDetails': 'Show details',
    'logs.files.dataContinuity.hideDetails': 'Hide details',
    'logs.files.dataContinuity.total': 'Total',
    'logs.files.dataContinuity.orderBroken': 'Order broken',
    'logs.files.dataContinuity.outOfOrderBuffered': 'Out-of-order buffered',
    'logs.files.dataContinuity.duplicateDropped': 'Duplicate dropped',
    'logs.files.dataContinuity.persistTimeout': 'Persist timeout',
    'logs.files.dataContinuity.rtBufferDrop': 'Buffer drop',
    'logs.files.dataContinuity.snMissing': 'SN missing',
    'logs.files.dataContinuity.snMissingHint':
      'No device SN extracted for these continuity issue events, so they cannot be grouped by device.',
    'logs.files.dataContinuity.linkCodeMissing': 'linkCode missing',
    'logs.files.dataContinuity.linkCodeMissingHint':
      'No linkCode extracted for these continuity issue events, so they cannot be grouped by session.',
    'logs.files.dataContinuity.requestIdMissing': 'requestId missing',
    'logs.files.dataContinuity.requestIdMissingHint':
      'No requestId extracted for these continuity issue events, so they cannot be traced by request.',
    'logs.files.dataContinuity.deviceTop': 'Device issues top',
    'logs.files.dataContinuity.linkCodeTop': 'Session issues top (by linkCode)',
    'logs.files.dataContinuity.requestIdTop': 'Request issues top (by requestId)',
    'logs.files.dataContinuity.deviceSn': 'Device SN',
    'logs.files.dataContinuity.linkCode': 'linkCode',
    'logs.files.dataContinuity.requestId': 'requestId',
    'logs.files.dataContinuity.traceSn': 'Trace SN',
    'logs.files.dataContinuity.traceLinkCode': 'Trace linkCode',
    'logs.files.dataContinuity.traceRequestId': 'Trace requestId',
    'logs.files.streamSessionQuality.title': 'Stream session quality (summary)',
    'logs.files.streamSessionQuality.hint':
      'Summarizes DATA_STREAM_SESSION_SUMMARY snapshots, computes a heuristic score with thresholds, and lets you trace by SN / linkCode / requestId.',
    'logs.files.streamSessionQuality.viewSessions': 'View session summaries',
    'logs.files.streamSessionQuality.showDetails': 'Show details',
    'logs.files.streamSessionQuality.hideDetails': 'Hide details',
    'logs.files.streamSessionQuality.total': 'Sessions',
    'logs.files.streamSessionQuality.score': 'Score',
    'logs.files.streamSessionQuality.scoreAvg': 'Avg score',
    'logs.files.streamSessionQuality.scoreHint':
      'The score is heuristic (based on summary fields and missing tracking), designed for quick triage.',
    'logs.files.streamSessionQuality.thresholdHint': 'Thresholds: warn <{warnBelow}, bad <{badBelow}',
    'logs.files.streamSessionQuality.qualityGood': 'OK',
    'logs.files.streamSessionQuality.qualityWarn': 'Warn',
    'logs.files.streamSessionQuality.qualityBad': 'Bad',
    'logs.files.streamSessionQuality.deviceSn': 'Device SN',
    'logs.files.streamSessionQuality.linkCode': 'linkCode',
    'logs.files.streamSessionQuality.requestId': 'requestId',
    'logs.files.streamSessionQuality.reason': 'Reason',
    'logs.files.streamSessionQuality.time': 'Time',
    'logs.files.streamSessionQuality.rawStartIndex': 'Start raw',
    'logs.files.streamSessionQuality.nextExpectedRaw': 'Expected raw',
    'logs.files.streamSessionQuality.lastRaw': 'Last raw',
    'logs.files.streamSessionQuality.bufferedOutOfOrderCount': 'Out-of-order buffer',
    'logs.files.streamSessionQuality.persistedMax': 'Persisted max',
    'logs.files.streamSessionQuality.reasonTop': 'Reasons top',
    'logs.files.streamSessionQuality.deviceTop': 'Device sessions top',
    'logs.files.streamSessionQuality.linkCodeTop': 'Session top (by linkCode)',
    'logs.files.streamSessionQuality.requestIdTop': 'Request top (by requestId)',
    'logs.files.streamSessionQuality.sessionsRecent': 'Recent sessions (latest first)',
    'logs.files.streamSessionQuality.snMissing': 'SN missing',
    'logs.files.streamSessionQuality.snMissingHint':
      'These session summaries are missing device SN, so they cannot be aggregated by device.',
    'logs.files.streamSessionQuality.linkCodeMissing': 'linkCode missing',
    'logs.files.streamSessionQuality.linkCodeMissingHint':
      'These session summaries are missing linkCode, so they cannot be aggregated by session.',
    'logs.files.streamSessionQuality.requestIdMissing': 'requestId missing',
    'logs.files.streamSessionQuality.requestIdMissingHint':
      'These session summaries are missing requestId, so they cannot be traced in Trace.',
    'logs.files.streamSessionQuality.reasonMissing': 'reason missing',
    'logs.files.streamSessionQuality.reasonMissingHint':
      'These session summaries are missing reason, so they cannot be aggregated by close reason.',
    'logs.files.streamSessionQuality.sessionStartIndexMissing': 'sessionStartIndex missing',
    'logs.files.streamSessionQuality.sessionStartIndexMissingHint':
      'These session summaries are missing sessionStartIndex.',
    'logs.files.streamSessionQuality.sessionStartAtMsMissing': 'sessionStartAtMs missing',
    'logs.files.streamSessionQuality.sessionStartAtMsMissingHint':
      'These session summaries are missing sessionStartAtMs.',
    'logs.files.streamSessionQuality.traceSn': 'Trace SN',
    'logs.files.streamSessionQuality.traceLinkCode': 'Trace linkCode',
    'logs.files.streamSessionQuality.traceRequestId': 'Trace requestId',
    'logs.files.bleQuality.title': 'Bluetooth SDK required logs check',
    'logs.files.bleQuality.hint':
      'Helps diagnose “missing/inconsistent logs”: checks required events presence, level mismatches, and start-without-end patterns.',
    'logs.files.bleQuality.coverage': 'Coverage (OK/Total)',
    'logs.files.bleQuality.missing': 'Missing (not found)',
    'logs.files.bleQuality.levelMismatch': 'Level mismatch',
    'logs.files.bleQuality.nameMismatch': 'Event name mismatch (case/whitespace)',
    'logs.files.bleQuality.parserErrors': 'Parser errors (PARSER_ERROR)',
    'logs.files.bleQuality.logan': 'Logan decrypt failed blocks',
    'logs.files.bleQuality.loganFailedBlocks': 'failed',
    'logs.files.bleQuality.missingList': 'Missing events',
    'logs.files.bleQuality.levelMismatchList': 'Level mismatch events',
    'logs.files.bleQuality.nameMismatchList': 'Event name mismatch (instrumentation string changed?)',
    'logs.files.bleQuality.pairChecks': 'Flow pair checks (start without end)',
    'logs.files.bleQuality.viewParserErrors': 'View parser errors',
    'logs.files.bleQuality.showAdvanced': 'Show advanced checks',
    'logs.files.bleQuality.hideAdvanced': 'Hide advanced checks',
    'logs.files.bleQuality.tab.missing': 'Missing',
    'logs.files.bleQuality.tab.levelMismatch': 'Level mismatch',
    'logs.files.bleQuality.tab.nameMismatch': 'Name mismatch',
    'logs.files.bleQuality.tab.pairChecks': 'Flow checks',
    'logs.files.bleQuality.openInLogs': 'Open in Logs',
    'logs.files.bleQuality.emptySection': 'No issues found for this section.',
    'logs.files.bleQuality.table.eventName': 'eventName',
    'logs.files.bleQuality.table.description': 'Description',
    'logs.files.bleQuality.table.expectedLevel': 'Expected level',
    'logs.files.bleQuality.table.category': 'Category',
    'logs.files.bleQuality.table.counts': 'Counts',
    'logs.files.bleQuality.table.matchedEventNames': 'Matched event names',
    'logs.files.bleQuality.table.flow': 'Flow',
    'logs.files.bleQuality.table.endEventNames': 'End events',
    'logs.files.bleQuality.table.pendingCount': 'Pending',
    'logs.files.bleQuality.table.actions': 'Actions',
    'logs.limit': 'Page size',
    'logs.keyword': 'Keyword (optional)',
    'logs.logFileIdOptional': 'logFileId (optional)',
    'logs.level': 'Level',
    'logs.level.all': 'All',
    'logs.levelGte': 'Min level',
    'logs.sdkVersion': 'SDK version',
    'logs.appId': 'App ID',
    'logs.trace': 'Trace',
    'logs.stats': 'Stats',
    'logs.eventNameOptional': 'eventName (optional)',
    'logs.startTime': 'Start time',
    'logs.endTime': 'End time',
    'logs.preset.1h': 'Last 1h',
    'logs.preset.24h': 'Last 24h',
    'logs.preset.7d': 'Last 7d',
    'logs.parserError': 'Parser error',
    'logs.onlyParserError': 'Only parser errors',
    'logs.detail.title': 'Event detail',
    'logs.detail.close': 'Close',
    'logs.detail.copyEventId': 'Copy event ID',
    'logs.detail.copyLogFileId': 'Copy logFileId',
    'logs.detail.context': 'Context',
    'logs.detail.current': 'Current event',
    'logs.detail.contextEmpty': 'No context',
    'logs.detail.msgJson': 'msgJson',
    'logs.detail.rawLine': 'rawLine (parser errors only)',
    'logs.fileStatus': 'Parse status',
    'logs.fileStatus.queued': 'Queued',
    'logs.fileStatus.parsed': 'Parsed',
    'logs.fileStatus.failed': 'Failed',
    'logs.fileStatus.events': 'Events',
    'logs.fileStatus.errors': 'Errors',
    'logs.invalidTimeRange': 'End time must be later than start time',
    'logs.invalidLogFileId': 'Invalid logFileId',
    'logs.timeRangeRequired': 'Please select start and end time first',
    'logs.empty':
      'No data. Expand the time range or wait for parsing; failures show as eventName=PARSER_ERROR.',
    'logs.msgContains': 'Message contains',
    'logs.msgContainsPlaceholder': 'Search msgJson content',
    'logs.bluetooth': 'Bluetooth',
    'logs.commands': 'Commands',
    'logs.commands.description': 'Track command send/response chains by requestId for BLE communication debugging.',
    'logs.commands.stats': 'Command Statistics',
    'logs.commands.total': 'Total',
    'logs.commands.success': 'Success',
    'logs.commands.timeout': 'Timeout',
    'logs.commands.error': 'Error',
    'logs.commands.pending': 'Pending',
    'logs.commands.avgDuration': 'Avg Duration',
    'logs.commands.list': 'Command List',
    'logs.commands.events': 'Events',
    'logs.commands.duration': 'Duration',
    'logs.commands.status': 'Status',
    'logs.commands.eventChain': 'Event Chain',
    'logs.trace.relatedDevices': 'Related Devices',
    'logs.trace.relatedSessions': 'Related Sessions',
    'common.optional': 'optional',
    'common.events': 'Events',
    'common.view': 'View',
    'common.noData': 'No data',
    'common.cancel': 'Cancel',
    'common.confirm': 'Confirm',
    'common.delete': 'Delete',
    'common.save': 'Save',
    'common.edit': 'Edit',
    'common.add': 'Add',
    'common.remove': 'Remove',
    'common.success': 'Operation successful',
    'common.error': 'Operation failed',

    'logs.filters.moreFilters': 'More Filters',
    'logs.filters.hideFilters': 'Hide Filters',
    'logs.filters.linkCode': 'Link Code',
    'logs.filters.requestId': 'Request ID',
    'logs.filters.deviceMac': 'Device MAC',
    'logs.filters.errorCode': 'Error Code',

    'logs.bluetooth.sessions': 'Sessions',
    'logs.bluetooth.commands': 'Commands',
    'logs.bluetooth.anomalies': 'Anomalies',
    'logs.bluetooth.errors': 'Error Distribution',
    'logs.bluetooth.compare': 'Compare',
    'logs.bluetooth.noSessions': 'No session data',
    'logs.bluetooth.sessionDetail': 'Session Detail',
    'logs.bluetooth.deviceInfo': 'Device Info',
    'logs.bluetooth.timeline': 'Timeline',

    'dialog.confirm.title': 'Confirm',
    'dialog.confirm.delete': 'Are you sure you want to delete?',
    'dialog.confirm.cancel': 'Cancel',
    'dialog.confirm.ok': 'OK',

    'incidents.title': 'Incidents',
    'incidents.titleLabel': 'Title',
    'incidents.severity': 'Severity',
    'incidents.status': 'Status',
    'incidents.startTime': 'startTime (ISO8601)',
    'incidents.endTime': 'endTime (optional, ISO8601 or blank)',
    'incidents.logEventIds': 'logEventIds (optional, comma-separated)',
    'incidents.markResolved': 'Mark resolved',
    'incidents.empty': 'No data (requires Support/Admin permission).',

    'severity.low': 'low',
    'severity.medium': 'medium',
    'severity.high': 'high',
    'severity.critical': 'critical',

    'incidentStatus.open': 'open',
    'incidentStatus.investigating': 'investigating',
    'incidentStatus.resolved': 'resolved',
    'incidentStatus.closed': 'closed',

    'projects.name': 'Name',
    'projects.type': 'Type',
    'projects.status': 'Status',
    'projects.role': 'Role',
    'projects.current': 'Current',
    'projects.setCurrent': 'Set current',

    'settings.title': 'Settings',
    'settings.apiBaseUrl': 'API Base URL',
    'settings.token': 'Token',
    'settings.tokenPresent': 'Present ({count} chars)',
    'settings.tokenMissing': 'Missing',
    'settings.selectedProjectId': 'Selected projectId',
    'settings.clearProjectSelection': 'Clear project selection',
    'settings.refreshPage': 'Refresh page',
    'settings.projects.title': 'Projects',
    'settings.projects.desc': 'Create multiple App projects and pick them across pages.',
    'settings.projects.empty': 'No accessible projects.',
    'settings.projects.noMatch': 'No matching projects.',
    'settings.projects.filter': 'Filter (optional)',
    'settings.projects.filterPlaceholder': 'Filter by name / ID / type…',
    'settings.projects.rename': 'Rename',
    'settings.projects.renamePrompt': 'Enter a new project name',
    'settings.projects.renameEmpty': 'Project name cannot be empty.',
    'settings.projects.archive': 'Archive',
    'settings.projects.archiveConfirm': 'Archive project “{name}”?',
    'settings.projects.restore': 'Restore',
    'settings.projects.restoreConfirm': 'Restore project “{name}”?',
    'settings.projects.updated': 'Updated',
    'settings.projects.createName': 'Project name',
    'settings.projects.setAsCurrent': 'Set as current after creation',
    'settings.projects.createApp': 'Create App project',
    'settings.projects.created': 'Created project: {name}',
    'settings.projects.adminOnly': 'Admin permission is required to create projects.',

    'settings.members.open': 'Members',
    'settings.members.title': 'Project members',
    'settings.members.email': 'Email',
    'settings.members.name': 'Name',
    'settings.members.role': 'Role',
    'settings.members.createdAt': 'Joined at',
    'settings.members.empty': 'No members.',
    'settings.members.addTitle': 'Add / update member',
    'settings.members.addHint':
      'Add a member by email (the email must exist in users). If the member already exists, it will update the role.',
    'settings.members.add': 'Add',
    'settings.members.remove': 'Remove',
    'settings.members.removeConfirm': 'Remove {email} from project “{project}”?',
    'settings.members.updated': 'Member updated',
    'settings.members.removed': 'Removed: {email}',

    'nav.knownIssues': 'Known Issues',
    'nav.reports': 'Reports',

    'knownIssues.title': 'Known Issues',
    'knownIssues.desc': 'Manage known issues and solutions for quick log error diagnosis.',
    'knownIssues.create': 'Add Issue',
    'knownIssues.empty': 'No issues recorded.',
    'knownIssues.titleLabel': 'Title',
    'knownIssues.description': 'Description',
    'knownIssues.solution': 'Solution',
    'knownIssues.category': 'Category',
    'knownIssues.severity': 'Severity',
    'knownIssues.errorCode': 'Error Code',
    'knownIssues.eventPattern': 'Event Pattern (regex)',
    'knownIssues.msgPattern': 'Message Pattern (regex)',
    'knownIssues.hitCount': 'Hit Count',
    'knownIssues.isActive': 'Active',
    'knownIssues.edit': 'Edit',
    'knownIssues.delete': 'Delete',
    'knownIssues.deleteConfirm': 'Delete issue "{title}"?',
    'knownIssues.created': 'Issue added',
    'knownIssues.updated': 'Issue updated',
    'knownIssues.deleted': 'Issue deleted',

    'issueCategory.connection': 'Connection',
    'issueCategory.data': 'Data',
    'issueCategory.device': 'Device',
    'issueCategory.app': 'App',
    'issueCategory.permission': 'Permission',
    'issueCategory.protocol': 'Protocol',
    'issueCategory.other': 'Other',

    'reports.title': 'Analysis Reports',
    'reports.desc': 'Generate log analysis reports with one click, including session analysis, error distribution, etc.',
    'reports.generate': 'Generate Report',
    'reports.empty': 'No reports.',
    'reports.type': 'Report Type',
    'reports.linkCode': 'Session linkCode',
    'reports.deviceMac': 'Device MAC',
    'reports.startTime': 'Start Time',
    'reports.endTime': 'End Time',
    'reports.view': 'View',
    'reports.export': 'Export Markdown',
    'reports.created': 'Report generated',

    'reportType.session_analysis': 'Session Analysis',
    'reportType.device_comparison': 'Device Comparison',
    'reportType.incident_summary': 'Incident Summary',
    'reportType.error_distribution': 'Error Distribution',
    'reportType.performance_analysis': 'Performance Analysis',

    'compare.title': 'Log Comparison',
    'compare.desc': 'Compare logs between two sessions or devices to quickly identify issues.',
    'compare.sessionA': 'Session A',
    'compare.sessionB': 'Session B',
    'compare.compare': 'Compare',
    'compare.summary': 'Comparison Summary',
    'compare.eventTypes': 'Event Types',
    'compare.timeline': 'Timeline',
    'compare.common': 'Common',
    'compare.onlyInA': 'Only in A',
    'compare.onlyInB': 'Only in B',
  },
};

function interpolate(template: string, vars: Record<string, string | number> | undefined) {
  if (!vars) return template;
  return template.replace(/\{(\w+)\}/g, (_, k: string) =>
    Object.prototype.hasOwnProperty.call(vars, k) ? String(vars[k]) : `{${k}}`,
  );
}

function translate(locale: Locale, key: string, vars?: Record<string, string | number>) {
  const msg = MESSAGES[locale][key] ?? MESSAGES.zh[key] ?? key;
  return interpolate(msg, vars);
}

type I18nContextValue = {
  locale: Locale;
  localeTag: 'zh-CN' | 'en-US';
  setLocale: (next: Locale) => void;
  t: (key: string, vars?: Record<string, string | number>) => string;
};

const I18nContext = createContext<I18nContextValue | null>(null);

export function I18nProvider(props: { children: React.ReactNode }) {
  const [locale, setLocaleState] = useState<Locale>('zh');

  useEffect(() => {
    const id = window.setTimeout(() => {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved === 'zh' || saved === 'en') setLocaleState(saved);
    }, 0);
    return () => window.clearTimeout(id);
  }, []);

  const setLocale = useCallback((next: Locale) => {
    setLocaleState(next);
    localStorage.setItem(STORAGE_KEY, next);
  }, []);

  const localeTag = locale === 'zh' ? 'zh-CN' : 'en-US';

  useEffect(() => {
    document.documentElement.lang = localeTag;
  }, [localeTag]);

  const value = useMemo<I18nContextValue>(
    () => ({
      locale,
      localeTag,
      setLocale,
      t: (key, vars) => translate(locale, key, vars),
    }),
    [locale, localeTag, setLocale],
  );

  return <I18nContext.Provider value={value}>{props.children}</I18nContext.Provider>;
}

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) {
    throw new Error('useI18n must be used within I18nProvider');
  }
  return ctx;
}
